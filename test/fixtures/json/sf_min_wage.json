{
  "name": "sf-min-wage",
  "salience": 60,
  "when": [
    {"binding": "shift", "type": "ScheduledShift", "fields": {"employee_id": {"binding_ref": "e"}, "start_at": {"binding_ref": "s"}, "end_at": {"binding_ref": "f"}, "location": "US/CA/SF", "planned_hours": {"binding_ref": "h"}}},
    {"binding": "law", "type": "LocationRegulation", "fields": {"location": "US/CA/SF", "constraint_type": ":min_wage", "params": {"binding_ref": "p"}}},
    {"binding": "rate", "type": "PayRate", "fields": {"employee_id": {"binding_ref": "e"}, "rate_type": ":hourly", "base_rate": {"binding_ref": "r"}}},
    {"guard": {"cmp": ["<", {"binding_ref": "r"}, {"call": ["get_min_wage", [{"binding_ref": "p"}]]}]}}
  ],
  "then": [
    {"emit": "ComplianceViolation", "fields": {"employee_id": {"binding_ref": "e"}, "period_key": {"call": ["bucket", [":day", {"binding_ref": "s"}]]}, "code": "MIN_WAGE", "severity": ":high", "details": "Minimum wage violation"}}
  ]
}